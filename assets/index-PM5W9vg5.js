var x=Object.defineProperty;var M=(r,e,t)=>e in r?x(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>M(r,typeof e!="symbol"?e+"":e,t);import{i as T,g as D,a as L,c as k,q as R,o as A,l as V,b as G}from"./firebase-C9DkQRrj.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();const f={initialHealth:5,visitorSpawnInterval:7e3,visitorLifetime:5e3,darkModeInterval:4e4,darkModeDuration:2e4},C={elf:"/images/elf.png",human:"/images/human.png",org:"/images/org.png",goblin:"/images/goblin.png",gandalf:"/images/gandalf.png",sauron:"/images/sauron.png",ring:"/images/ring.png",gollum:"/images/gollum.png",heart:"/images/heart.png"},B={hotel1:"/images/hotel1.png",hotel2:"/images/hotel2.png",hotel3:"/images/hotel3.png",hotel4:"/images/hotel4.png"},H={background:"/sounds/lotr.mp3",bad:"/sounds/bad-sound.mp3",good:"/sounds/good-sound.mp3",gollum:"/sounds/gollum-sound.mp3",gandalf:"/sounds/gandalf-sound.mp3",sauron:"/sounds/sauron-sound.mp3",ring:"/sounds/ring-sound.mp3"},p={goodVisitor:10,badVisitor:-10,specialCharacter:100,specialCharacterPenalty:-20},b={badVisitor:-1,specialCharacter:-2},S={PAUSE:" ",ESCAPE:"Escape",RESTART:"r",MUTE:"m"};class F{constructor(){n(this,"state","menu");n(this,"score",0);n(this,"health",f.initialHealth);n(this,"userName","");n(this,"hasRing",!1);n(this,"currentSide","good");n(this,"isDarkMode",!1);n(this,"visitorCounts",{elf:0,human:0,org:0,goblin:0});n(this,"goodWins",[]);n(this,"darkWins",[])}getState(){return this.state}setState(e){this.state=e}getScore(){return this.score}addScore(e){this.score+=e}getHealth(){return this.health}setHealth(e){this.health=Math.max(0,e)}addHealth(e){this.health=Math.max(0,this.health+e)}getUserName(){return this.userName}setUserName(e){this.userName=e.trim().toUpperCase()}hasTheRing(){return this.hasRing}setRing(e){this.hasRing=e}getCurrentSide(){return this.currentSide}setCurrentSide(e){this.currentSide=e}isDarkModeActive(){return this.isDarkMode}setDarkMode(e){this.isDarkMode=e,this.currentSide=e?"evil":"good"}getVisitorCounts(){return{...this.visitorCounts}}incrementVisitorCount(e){this.visitorCounts[e]++}getGoodWins(){return[...this.goodWins]}addGoodWin(e){this.goodWins.push(e)}removeGoodWin(e){const t=this.goodWins.indexOf(e);t>-1&&this.goodWins.splice(t,1)}getDarkWins(){return[...this.darkWins]}addDarkWin(e){this.darkWins.push(e)}removeDarkWin(e){const t=this.darkWins.indexOf(e);t>-1&&this.darkWins.splice(t,1)}reset(){this.state="menu",this.score=0,this.health=f.initialHealth,this.userName="",this.hasRing=!1,this.currentSide="good",this.isDarkMode=!1,this.visitorCounts={elf:0,human:0,org:0,goblin:0},this.goodWins=[],this.darkWins=[]}}class W{constructor(){n(this,"events",new Map)}on(e,t){this.events.has(e)||this.events.set(e,[]),this.events.get(e).push(t)}off(e,t){const s=this.events.get(e);if(s){const i=s.indexOf(t);i>-1&&s.splice(i,1)}}emit(e,...t){const s=this.events.get(e);s&&s.forEach(i=>i(...t))}clear(){this.events.clear()}}class O{constructor(){n(this,"audioElements",new Map);n(this,"config",{backgroundVolume:.3,effectsVolume:1,muted:!1});this.initializeAudio()}initializeAudio(){Object.entries(H).forEach(([e,t])=>{const s=new Audio(t);e==="background"?(s.loop=!0,s.volume=this.config.backgroundVolume):s.volume=this.config.effectsVolume,this.audioElements.set(e,s)})}async play(e){if(this.config.muted||e!=="background"&&this.config.effectsVolume===0)return;const t=this.audioElements.get(e);if(t)try{t.currentTime=0,await t.play()}catch(s){console.warn(`Audio playback failed for ${e}. User interaction may be required.`,s),e==="background"&&document.addEventListener("click",()=>{t.play().catch(()=>{})},{once:!0})}}stop(e){const t=this.audioElements.get(e);t&&(t.pause(),t.currentTime=0)}setVolume(e,t){const s=this.audioElements.get(e);s&&(s.volume=Math.max(0,Math.min(1,t)))}setBackgroundVolume(e){this.config.backgroundVolume=Math.max(0,Math.min(1,e));const t=this.audioElements.get("background");t&&(t.volume=this.config.backgroundVolume)}setEffectsVolume(e){this.config.effectsVolume=Math.max(0,Math.min(1,e)),this.audioElements.forEach((t,s)=>{s!=="background"&&(t.volume=this.config.effectsVolume)})}mute(){this.config.muted=!0,this.audioElements.forEach(e=>e.pause())}unmute(){this.config.muted=!1}toggleMute(){return this.config.muted=!this.config.muted,this.config.muted&&this.audioElements.forEach(e=>e.pause()),this.config.muted}isMuted(){return this.config.muted}setEffectsEnabled(e){e||this.audioElements.forEach((t,s)=>{s!=="background"&&(t.pause(),t.currentTime=0)}),this.config.effectsVolume=e?1:0}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e},e.backgroundVolume!==void 0&&this.setBackgroundVolume(e.backgroundVolume),e.effectsVolume!==void 0&&this.setEffectsVolume(e.effectsVolume)}cleanup(){this.audioElements.forEach(e=>{e.pause(),e.src=""}),this.audioElements.clear()}}class N{constructor(){n(this,"app",null);n(this,"db",null);n(this,"initialized",!1);this.initialize()}initialize(){try{const e={apiKey:"AIzaSyBJ9aJ0Uw7CtfszGxi9zr5n79k650gpYo4",authDomain:"hotel-middle-earth.firebaseapp.com",projectId:"hotel-middle-earth",storageBucket:"hotel-middle-earth.appspot.com",messagingSenderId:"285009011754",appId:"1:285009011754:web:9567a429298ed847d14f53"};if(!e.apiKey||!e.projectId){console.warn("Firebase configuration is missing. Leaderboard features will be disabled.");return}this.app=T(e),this.db=D(this.app),this.initialized=!0}catch(e){console.error("Failed to initialize Firebase:",e)}}async saveScore(e){if(!this.initialized||!this.db)return console.warn("Firebase not initialized. Score not saved."),!1;if(!e.userName||e.userName.trim()==="")return console.error("Invalid username. Score not saved."),!1;try{const t={userName:e.userName,score:e.score,timestamp:Date.now()};return await L(k(this.db,"users"),t),!0}catch(t){return console.error("Error saving score:",t),!1}}async getTopScores(e=10){if(!this.initialized||!this.db)return console.warn("Firebase not initialized. Cannot fetch scores."),[];try{const t=R(k(this.db,"users"),A("score","desc"),V(e)),s=await G(t),i=[];return s.forEach(o=>{const l=o.data();i.push({userName:l.userName,score:l.score,timestamp:l.timestamp})}),i}catch(t){return console.error("Error fetching top scores:",t),[]}}isInitialized(){return this.initialized}}const y={SETTINGS:"hme_settings",HIGH_SCORE:"hme_high_score",TUTORIAL_SHOWN:"hme_tutorial_shown"};class z{constructor(){n(this,"isAvailable");this.isAvailable=this.checkStorageAvailability()}checkStorageAvailability(){try{const e="__storage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}saveSettings(e){if(this.isAvailable)try{localStorage.setItem(y.SETTINGS,JSON.stringify(e))}catch(t){console.error("Failed to save settings:",t)}}loadSettings(){if(!this.isAvailable)return null;try{const e=localStorage.getItem(y.SETTINGS);return e?JSON.parse(e):null}catch(e){return console.error("Failed to load settings:",e),null}}saveHighScore(e){if(this.isAvailable)try{const t=this.loadHighScore();e>t&&localStorage.setItem(y.HIGH_SCORE,e.toString())}catch(t){console.error("Failed to save high score:",t)}}loadHighScore(){if(!this.isAvailable)return 0;try{const e=localStorage.getItem(y.HIGH_SCORE);return e?parseInt(e,10):0}catch(e){return console.error("Failed to load high score:",e),0}}setTutorialShown(e){if(this.isAvailable)try{localStorage.setItem(y.TUTORIAL_SHOWN,e.toString())}catch(t){console.error("Failed to save tutorial status:",t)}}isTutorialShown(){if(!this.isAvailable)return!1;try{return localStorage.getItem(y.TUTORIAL_SHOWN)==="true"}catch(e){return console.error("Failed to load tutorial status:",e),!1}}clear(){if(this.isAvailable)try{Object.values(y).forEach(e=>{localStorage.removeItem(e)})}catch(e){console.error("Failed to clear storage:",e)}}}function E(r,e){return Math.floor(Math.random()*(e-r+1))+r}function a(r,e){const t=document.createElement(r);return e?.id&&(t.id=e.id),e?.className&&(t.className=e.className),e?.textContent&&(t.textContent=e.textContent),e?.innerHTML&&(t.innerHTML=e.innerHTML),e?.attributes&&Object.entries(e.attributes).forEach(([s,i])=>{t.setAttribute(s,i)}),e?.styles&&Object.assign(t.style,e.styles),t}function P(r){return r.requestFullscreen?r.requestFullscreen():r.webkitRequestFullscreen?r.webkitRequestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.msRequestFullscreen?r.msRequestFullscreen():Promise.reject(new Error("Fullscreen not supported"))}class ${constructor(e=!1){n(this,"type");n(this,"position");n(this,"domElement");n(this,"targetPosition",{x:0,y:0});n(this,"animationFrameId",null);n(this,"hasRing");this.hasRing=e,this.position={x:E(10,80),y:E(25,75)},this.type=this.determineType(),this.domElement=this.createDomElement()}determineType(){const e=E(1,100);if(e<=3&&!this.hasRing)return"ring";if(e>=4&&e<=6)return"sauron";if(e>=7&&e<=9)return"gandalf";if(e>=10&&e<=29)return"gollum";const t=E(1,4);return["elf","human","org","goblin"][t-1]}createDomElement(){const e=document.createElement("img");return e.id="visitor",e.className=this.type,e.src=C[this.type],e.style.position="absolute",e.style.left=`${this.position.x}vw`,e.style.bottom=`${this.position.y}vh`,e.style.transition="all 0.3s ease-out",e.style.cursor="pointer",e.setAttribute("role","button"),e.setAttribute("aria-label",`${this.type} visitor`),e.setAttribute("tabindex","0"),e}setTargetPosition(e){const t={human:{good:{x:55,y:0},evil:{x:0,y:0}},elf:{good:{x:88,y:0},evil:{x:22,y:0}},goblin:{good:{x:55,y:0},evil:{x:0,y:0}},org:{good:{x:88,y:0},evil:{x:25,y:0}},sauron:{good:{x:25,y:0},evil:{x:25,y:0}},gandalf:{good:{x:55,y:0},evil:{x:55,y:0}},ring:{good:{x:58,y:5},evil:{x:28,y:5}},gollum:{good:{x:55,y:0},evil:{x:25,y:0}}};this.targetPosition=e?t[this.type].evil:t[this.type].good}startMoving(e){this.setTargetPosition(e);const t=()=>{const i=this.targetPosition.x-this.position.x,o=this.targetPosition.y-this.position.y;(Math.abs(i)>.1||Math.abs(o)>.1)&&(this.position.x+=i*.5*.02,this.position.y+=o*.5*.02,this.domElement.style.left=`${this.position.x}vw`,this.domElement.style.bottom=`${this.position.y}vh`,this.animationFrameId=requestAnimationFrame(t))};this.animationFrameId=requestAnimationFrame(t)}stopMoving(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stopMoving(),this.domElement.parentElement&&this.domElement.remove()}}class _{constructor(e){n(this,"containerElement");this.containerElement=this.createContainer(),e.appendChild(this.containerElement),this.createHotels()}createContainer(){const e=document.createElement("div");return e.id="hotel-container",e.style.position="absolute",e.style.width="100vw",e.style.height="20vh",e.style.bottom="0",e}createHotels(){[{id:"hotel1",left:"0"},{id:"hotel2",left:"25vw"},{id:"hotel3",left:"50vw"},{id:"hotel4",right:"0vw"}].forEach(({id:t,left:s,right:i})=>{const o=document.createElement("img");o.id=t,o.src=B[t],o.style.position="absolute",o.style.height="20vh",o.style.width="auto",o.setAttribute("alt",`${t} building`),s?o.style.left=s:i&&(o.style.right=i),this.containerElement.appendChild(o)})}destroy(){this.containerElement.parentElement&&this.containerElement.remove()}}class U{constructor(e){n(this,"scoreDisplay");n(this,"healthDisplay");n(this,"ringDisplay");n(this,"parentElement");this.parentElement=e,this.scoreDisplay=this.createScoreDisplay(),this.healthDisplay=this.createHealthDisplay(),this.ringDisplay=this.createRingDisplay()}createScoreDisplay(){const e=a("span",{id:"scoreDisplay",textContent:"Score: 0",styles:{color:"#fff",position:"absolute",right:"1vw",fontSize:"1.5vw",textAlign:"center",top:"1vh"}});return this.parentElement.appendChild(e),e}createHealthDisplay(){const e=a("span",{id:"healthDisplay",styles:{marginLeft:"1vw",color:"#fff",textAlign:"center",fontSize:"2vw",position:"absolute",top:"1vh",left:"0"}});return this.parentElement.appendChild(e),e}createRingDisplay(){const e=a("span",{id:"ringDisplay",styles:{position:"absolute",top:"1vh",left:"50vw",transform:"translateX(-50%)"}});return this.parentElement.appendChild(e),e}updateScore(e){this.scoreDisplay.textContent=`Score: ${e}`}updateHealth(e){const t=a("img",{id:"heart-image",attributes:{src:C.heart,alt:"health indicator"},styles:{width:"auto",height:"3vh",marginTop:"1vh"}});this.healthDisplay.innerHTML="",this.healthDisplay.appendChild(t),this.healthDisplay.appendChild(document.createTextNode(` ${e}`))}updateRing(e,t,s){if(this.ringDisplay.innerHTML="",e){const i=a("img",{id:"ring-image",attributes:{src:C.ring,alt:"the one ring",role:"button",tabindex:"0"},styles:{width:"2vw",height:"auto",cursor:"pointer",paddingTop:"1vh"}});s&&(i.addEventListener("click",s),i.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),s())})),this.ringDisplay.appendChild(i)}}showInfo(e,t=2e3){const s=a("p",{id:"info-text",innerHTML:e});this.parentElement.appendChild(s),setTimeout(()=>{s.parentElement&&s.remove()},t)}destroy(){this.scoreDisplay.remove(),this.healthDisplay.remove(),this.ringDisplay.remove()}}class q{constructor(e,t){n(this,"parentElement");n(this,"onStart");n(this,"onInstructions");n(this,"onShowLeaderboard");this.parentElement=e,this.onStart=t.onStart,this.onInstructions=t.onInstructions,this.onShowLeaderboard=t.onShowLeaderboard}show(){const e=a("form",{id:"nameForm",innerHTML:`
        <label for="nameInput" id="title">Hotel Middle Earth</label>
        <div class="menu-input-section">
          <input type="text" id="nameInput" placeholder="Please enter your name" required>
          <input id="submit-btn" type="submit" class="submit-btn" value="Start Game">
        </div>
        <div class="menu-buttons">
          <button type="button" id="instructions-button">Instructions</button>
          <button type="button" id="top-scores-button">Top Scores</button>
        </div>
        <div class="menu-social-links">
          <a href="https://utkucikmaz.com" target="_blank" rel="noopener noreferrer" class="social-link">
            <img src="/images/logo/logo.png" alt="Website" class="social-icon">
            <span>Website</span>
          </a>
          <a href="https://github.com/utkucikmaz/Hotel-Middle-Earth" target="_blank" rel="noopener noreferrer" class="social-link">
            <img src="/images/logo/github-icon.svg" alt="GitHub" class="social-icon">
            <span>GitHub</span>
          </a>
          <a href="https://www.linkedin.com/in/utkucikmaz" target="_blank" rel="noopener noreferrer" class="social-link">
            <img src="/images/logo/linkedin-icon.svg" alt="LinkedIn" class="social-icon">
            <span>LinkedIn</span>
          </a>
        </div>
      `});this.parentElement.innerHTML="",this.parentElement.appendChild(e);const t=document.getElementById("instructions-button");t&&t.addEventListener("click",i=>{i.preventDefault(),this.onInstructions&&this.onInstructions()});const s=document.getElementById("top-scores-button");s&&s.addEventListener("click",i=>{i.preventDefault(),this.onShowLeaderboard&&this.onShowLeaderboard()}),e.addEventListener("submit",async i=>{i.preventDefault();const l=document.getElementById("nameInput").value.trim();if(l===""){alert("Please enter a valid name.");return}try{await P(this.parentElement)}catch(c){console.warn("Fullscreen not available:",c)}this.onStart&&this.onStart(l)})}hide(){const e=document.getElementById("nameForm");e&&(e.style.display="none")}}class Y{constructor(e,t){n(this,"parentElement");n(this,"onBack");this.parentElement=e,this.onBack=t.onBack}show(){const e=a("div",{id:"instructionsContainer",innerHTML:`
        <h1 id="instruction-title">Welcome to the Hotel Middle Earth!</h1>
        <div id="backbutton-container">
          <button id="backButton">Back</button>
        </div>
        <br/>
        <ul id="instruction-list">
          <div id="inst-good">
            <li>In this background collect <img src="./images/elf.png" class="inst-char"> and <img src="./images/human.png" class="inst-char"> to score points.</li>
            <li>Avoid <img src="./images/org.png" class="inst-char"> and <img src="./images/goblin.png" class="inst-char"> to maintain your health.</li>
            <li>Be careful about the <img src="./images/gollum.png" class="inst-char" id="gollum-inst"> if you have the <img src="./images/ring.png" class="inst-char" id="ring-inst">, he is a filthy thief.</li>
            <li>If you serve <img src="./images/sauron.png" class="inst-char"> you lose double health and score.</li>
            <li>If you lose all your health before you destroy the ring, the game is over.</li>
            <li>If you find both <img src="./images/ring.png" class="inst-char" id="ring-inst"> and <img src="./images/gandalf.png" class="inst-char">, <img src="./images/hotel3.png" class="inst-char"> wins!</li>
          </div>
          <div id="inst-bad">
            <li>Eye mode will activate periodically, be cautious!</li>
            <li>Now you must obey <img src="./images/sauron.png" class="inst-char"> and collect <img src="./images/org.png" class="inst-char"> and <img src="./images/goblin.png" class="inst-char">.</li>
            <li>Even though you serve <img src="./images/sauron.png" class="inst-char">, <img src="./images/gollum.png" class="inst-char" id="gollum-inst"> is still a thief.</li>
            <li>If you serve <img src="./images/gandalf.png" class="inst-char"> you lose double health and score.</li>
            <li>If you lose all your health before you destroy the ring, the game is over.</li>
            <li>If you find both <img src="./images/ring.png" class="inst-char" id="ring-inst"> and <img src="./images/sauron.png" class="inst-char">, <img src="./images/hotel2.png" class="inst-char"> wins!</li>
          </div>
        </ul>
      `});this.parentElement.innerHTML="",this.parentElement.appendChild(e);const t=e.querySelector("#backButton");t&&this.onBack&&t.addEventListener("click",this.onBack)}hide(){const e=document.getElementById("instructionsContainer");e&&e.remove()}}class j{constructor(e,t){n(this,"parentElement");n(this,"onRestart");n(this,"onShowLeaderboard");this.parentElement=e,this.onRestart=t.onRestart,this.onShowLeaderboard=t.onShowLeaderboard}show(e,t,s){this.parentElement.innerHTML="";let i;e==="defeat"?i=this.createDefeatScreen(t,s):e==="gandalf"?i=this.createGandalfWinScreen(t,s):i=this.createSauronWinScreen(t,s),this.parentElement.appendChild(i),this.setupEventListeners(i)}createDefeatScreen(e,t){const s=a("img",{className:"over-gif",attributes:{src:"./images/over.gif",alt:"ring couldn't be destroyed"}}),i=a("p",{className:"game-over",id:"game-over-id",innerHTML:`
        <p class="over-title">${e} couldn't destroy the ring.</p>
        <p>I don't say it was ${e}'s fault, but only ${t}?</p>
        <p>Middle Earth needs better fighters</p>
      `});return i.insertBefore(s,i.firstChild),this.addButtons(i),i}createGandalfWinScreen(e,t){const s=a("img",{id:"gandalf-won",attributes:{src:"./images/gandalf-won.gif",alt:"a beautiful image of gandalf"}}),i=a("p",{className:"gandalf-class",id:"game-over-id",innerHTML:`
        <p class="over-title">Now Middle Earth is Free!!</p>
        <div id="gandalf-info-container">
          <p>Gandalf has really come on time as he promised to Aragorn</p>
          <p><i>"Look to my coming on the first light of the fifth day, at dawn look to the east..."</i></p>
          <p>${e} helped Gandalf and all his friends during the wars.</p>
          <p>${e} found ${t} soldiers and ran to the heart of the enemy.</p>
        </div>
      `});return i.insertBefore(s,i.firstChild),this.addButtons(i),i}createSauronWinScreen(e,t){const s=a("img",{id:"sauron-won",attributes:{src:"./images/sauron-won.gif",alt:"a powerful image of sauron"}}),i=a("p",{className:"sauron-class",id:"game-over-id",innerHTML:`
        <p class="over-title">Sauron took the Middle Earth over.</p>
        <div class="sauron-info-container">
          <p>Now everyone must obey the dark lord.</p>
          <p>${e} served Sauron loyally...</p>
          <p>Sauron gave ${e} ${t} soldiers to invade more!</p>
          <br/>
        </div>
      `});return i.insertBefore(s,i.firstChild),this.addButtons(i),i}addButtons(e){const t=a("button",{id:"players-button",textContent:"Top Players"}),s=a("p",{className:"restart",textContent:"Press space to restart"});e.appendChild(t),e.appendChild(s)}setupEventListeners(e){const t=e.querySelector("#players-button");t&&this.onShowLeaderboard&&t.addEventListener("click",this.onShowLeaderboard);const s=i=>{i.key===" "&&this.onRestart&&(i.preventDefault(),document.removeEventListener("keydown",s),this.onRestart())};document.addEventListener("keydown",s)}hide(){const e=document.getElementById("game-over-id");e&&e.remove()}}class K{constructor(e,t){n(this,"parentElement");n(this,"onBack");this.parentElement=e,this.onBack=t.onBack}show(e,t){const s=a("div",{id:"topPlayersContainer"}),i=a("p",{textContent:"Top Players",className:"top-players-title"});s.appendChild(i);const o=a("ol",{className:"player-list"});if(e.length===0){const h=a("li",{textContent:"No scores yet. Be the first!",styles:{listStyle:"none"}});o.appendChild(h)}else e.forEach(h=>{const m=a("li",{textContent:`${h.userName}: ${h.score}`});o.appendChild(m)});s.appendChild(o);const l=a("button",{textContent:"Back",className:"back-button"}),c=t??this.onBack;c&&l.addEventListener("click",c),s.appendChild(l),this.parentElement.innerHTML="",this.parentElement.appendChild(s)}hide(){const e=document.getElementById("topPlayersContainer");e&&e.remove()}}class J{constructor(e,t){n(this,"parentElement");n(this,"container",null);n(this,"onResume");n(this,"onRestart");n(this,"onSettings");this.parentElement=e,this.onResume=t.onResume,this.onRestart=t.onRestart,this.onSettings=t.onSettings}show(){if(this.container)return;this.container=a("div",{id:"pauseMenu",styles:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(0, 0, 0, 0.9)",padding:"3rem",borderRadius:"1rem",zIndex:"1000",textAlign:"center",minWidth:"300px"}});const e=a("h2",{textContent:"Game Paused",styles:{color:"#fff",marginBottom:"2rem",fontSize:"2rem"}});this.container.appendChild(e);const t={display:"block",width:"100%",padding:"1rem",margin:"0.5rem 0",fontSize:"1rem",backgroundColor:"transparent",color:"#fff",border:"2px solid #fff",borderRadius:"5px",cursor:"pointer"},s=a("button",{textContent:"Resume (Space)",styles:t});s.addEventListener("click",()=>this.onResume?.()),this.container.appendChild(s);const i=a("button",{textContent:"Restart (R)",styles:t});i.addEventListener("click",()=>this.onRestart?.()),this.container.appendChild(i);const o=a("button",{textContent:"Settings",styles:t});o.addEventListener("click",()=>this.onSettings?.()),this.container.appendChild(o),this.parentElement.appendChild(this.container)}hide(){this.container&&(this.container.remove(),this.container=null)}isVisible(){return this.container!==null}}class X{constructor(e,t,s,i){n(this,"parentElement");n(this,"container",null);n(this,"audioService");n(this,"onClose");n(this,"onApply");n(this,"config");this.parentElement=e,this.audioService=t,this.config={...s},this.onClose=i.onClose,this.onApply=i.onApply}show(){if(this.container)return;this.container=a("div",{id:"settingsMenu",styles:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",backgroundColor:"rgba(0, 0, 0, 0.95)",padding:"3rem",borderRadius:"1rem",zIndex:"2000",minWidth:"400px",maxWidth:"500px",border:"2px solid rgba(255, 255, 255, 0.3)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.8)"}});const e=a("h2",{textContent:"Settings",styles:{color:"#fff",marginBottom:"2rem",fontSize:"2rem",textAlign:"center",borderBottom:"2px solid rgba(255, 255, 255, 0.2)",paddingBottom:"1rem"}});this.container.appendChild(e);const t=this.createSection("Audio Settings");this.container.appendChild(t);const s=this.createToggle("Background Music",this.config.musicEnabled,u=>{this.config.musicEnabled=u,u?this.audioService.unmute():this.audioService.mute()});t.appendChild(s);const i=this.createToggle("Sound Effects",this.config.soundEffectsEnabled,u=>{this.config.soundEffectsEnabled=u,this.audioService.setEffectsEnabled(u)});t.appendChild(i);const o=this.createSlider("Music Volume",Math.round(this.config.musicVolume*100),0,100,5,u=>{this.config.musicVolume=u/100,this.audioService.setBackgroundVolume(this.config.musicVolume)});t.appendChild(o);const l=this.createSlider("Effects Volume",Math.round(this.config.effectsVolume*100),0,100,5,u=>{this.config.effectsVolume=u/100,this.audioService.setEffectsVolume(this.config.effectsVolume)});t.appendChild(l);const c=this.createSection("Game Settings");this.container.appendChild(c);const h=this.createSlider("Characters Per Wave",this.config.spawnCount,4,12,1,u=>{this.config.spawnCount=u});c.appendChild(h);const m=a("div",{styles:{display:"flex",gap:"1rem",marginTop:"2rem"}}),g=a("button",{textContent:"Apply",styles:{flex:"1",padding:"1rem",fontSize:"1rem",backgroundColor:"#27ae60",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",fontWeight:"bold"}});g.addEventListener("click",()=>{this.hide(),this.onApply?.(this.config)}),g.addEventListener("mouseenter",()=>{g.style.backgroundColor="#2ecc71"}),g.addEventListener("mouseleave",()=>{g.style.backgroundColor="#27ae60"});const d=a("button",{textContent:"Close",styles:{flex:"1",padding:"1rem",fontSize:"1rem",backgroundColor:"transparent",color:"#fff",border:"2px solid #fff",borderRadius:"5px",cursor:"pointer"}});d.addEventListener("click",()=>{this.hide(),this.onClose?.()}),d.addEventListener("mouseenter",()=>{d.style.backgroundColor="rgba(255, 255, 255, 0.1)"}),d.addEventListener("mouseleave",()=>{d.style.backgroundColor="transparent"}),m.appendChild(g),m.appendChild(d),this.container.appendChild(m),this.parentElement.appendChild(this.container)}createSection(e){const t=a("div",{styles:{marginBottom:"1.5rem"}}),s=a("h3",{textContent:e,styles:{color:"#fff",fontSize:"1.2rem",marginBottom:"1rem",opacity:"0.8"}});return t.appendChild(s),t}createToggle(e,t,s){const i=a("div",{styles:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem",padding:"0.5rem"}}),o=a("label",{textContent:e,styles:{color:"#fff",fontSize:"1rem"}}),l=a("button",{textContent:t?"ON":"OFF",styles:{padding:"0.5rem 1.5rem",fontSize:"0.9rem",backgroundColor:t?"#27ae60":"#e74c3c",color:"#fff",border:"none",borderRadius:"5px",cursor:"pointer",minWidth:"70px",fontWeight:"bold"}});return l.addEventListener("click",()=>{const c=l.textContent==="OFF";l.textContent=c?"ON":"OFF",l.style.backgroundColor=c?"#27ae60":"#e74c3c",s(c)}),i.appendChild(o),i.appendChild(l),i}createSlider(e,t,s,i,o,l){const c=a("div",{styles:{marginBottom:"1rem",padding:"0.5rem"}}),h=a("div",{styles:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"}}),m=a("label",{textContent:e,styles:{color:"#fff",fontSize:"1rem"}}),g=a("span",{textContent:String(t),styles:{color:"#27ae60",fontSize:"1rem",fontWeight:"bold",minWidth:"30px",textAlign:"right"}});h.appendChild(m),h.appendChild(g);const d=document.createElement("input");return d.type="range",d.min=String(s),d.max=String(i),d.step=String(o),d.value=String(t),d.style.width="100%",d.style.cursor="pointer",d.addEventListener("input",()=>{const u=parseInt(d.value);g.textContent=String(u),l(u)}),c.appendChild(h),c.appendChild(d),c}hide(){this.container&&(this.container.remove(),this.container=null)}isVisible(){return this.container!==null}updateConfig(e){this.config={...e}}}class Q{constructor(e){n(this,"particles",[]);n(this,"container");this.container=e}createClickEffect(e,t,s){const i={good:["#27ae60","#2ecc71","#3498db"],bad:["#e74c3c","#c0392b","#e67e22"],special:["#f39c12","#f1c40f","#e67e22","#ffd700"]},o=s==="special"?20:12,l=i[s];for(let c=0;c<o;c++){const h=document.createElement("div");h.className="particle";const m=Math.PI*2*c/o,g=50+Math.random()*50,d=s==="special"?8+Math.random()*4:4+Math.random()*4,u=l[Math.floor(Math.random()*l.length)];h.style.cssText=`
        position: absolute;
        left: ${e}px;
        top: ${t}px;
        width: ${d}px;
        height: ${d}px;
        background: ${u};
        border-radius: 50%;
        pointer-events: none;
        z-index: 1000;
        box-shadow: 0 0 10px ${u};
      `,this.container.appendChild(h),this.particles.push(h);const w=Math.cos(m)*g,v=Math.sin(m)*g;this.animateParticle(h,e,t,w,v)}}animateParticle(e,t,s,i,o){let l=0;const c=60,h=()=>{l++;const m=l/c,g=t+i*m,d=s+o*m+m*m*100,u=1-m,w=1-m*.5;if(e.style.left=`${g}px`,e.style.top=`${d}px`,e.style.opacity=`${u}`,e.style.transform=`scale(${w})`,l<c)requestAnimationFrame(h);else{e.remove();const v=this.particles.indexOf(e);v>-1&&this.particles.splice(v,1)}};requestAnimationFrame(h)}createScorePopup(e,t,s,i){const o=document.createElement("div");o.className="score-popup",o.textContent=`${i?"+":""}${s}`,o.style.cssText=`
      position: absolute;
      left: ${e}px;
      top: ${t}px;
      font-size: 2rem;
      font-weight: bold;
      color: ${i?"#27ae60":"#e74c3c"};
      text-shadow: 0 0 10px ${i?"#27ae60":"#e74c3c"};
      pointer-events: none;
      z-index: 1000;
      animation: scoreFloat 1s ease-out forwards;
    `,this.container.appendChild(o),setTimeout(()=>{o.remove()},1e3)}cleanup(){this.particles.forEach(e=>e.remove()),this.particles=[]}}const I=document.createElement("style");I.textContent=`
  @keyframes scoreFloat {
    0% {
      opacity: 1;
      transform: translateY(0) scale(0.5);
    }
    50% {
      opacity: 1;
      transform: translateY(-30px) scale(1.2);
    }
    100% {
      opacity: 0;
      transform: translateY(-60px) scale(0.8);
    }
  }

  .particle {
    transition: opacity 0.3s ease;
  }
`;document.head.appendChild(I);class Z{constructor(e){n(this,"gameState");n(this,"eventManager");n(this,"audioService");n(this,"firebaseService");n(this,"storageService");n(this,"parentElement");n(this,"visitors",[]);n(this,"hotel",null);n(this,"hud",null);n(this,"particleEffect");n(this,"menu");n(this,"instructions");n(this,"gameOver");n(this,"leaderboard");n(this,"pauseMenu");n(this,"settings");n(this,"settingsConfig",{musicEnabled:!0,soundEffectsEnabled:!0,spawnCount:8,musicVolume:.3,effectsVolume:1});n(this,"visitorSpawnInterval",null);n(this,"visitorCleanupTimeout",null);n(this,"darkModeInterval",null);n(this,"darkModeTimeout",null);n(this,"cycleInterval",null);this.parentElement=e,this.gameState=new F,this.eventManager=new W,this.audioService=new O,this.firebaseService=new N,this.storageService=new z,this.particleEffect=new Q(e),this.menu=new q(e,{onStart:t=>this.startGame(t),onInstructions:()=>this.showInstructions(),onShowLeaderboard:()=>this.showLeaderboardFromMenu()}),this.instructions=new Y(e,{onBack:()=>this.showMenu()}),this.gameOver=new j(e,{onRestart:()=>this.restart(),onShowLeaderboard:()=>this.showLeaderboard()}),this.leaderboard=new K(e,{onBack:()=>this.restart()}),this.pauseMenu=new J(e,{onResume:()=>this.resumeGame(),onRestart:()=>this.restart(),onSettings:()=>this.showSettings()}),this.settings=new X(e,this.audioService,this.settingsConfig,{onClose:()=>this.resumeGame(),onApply:t=>this.applySettings(t)}),this.setupKeyboardControls(),this.showMenu()}setupKeyboardControls(){document.addEventListener("keydown",e=>{this.gameState.getState()==="playing"?e.key===S.PAUSE||e.key===S.ESCAPE?(e.preventDefault(),this.pauseGame()):e.key===S.MUTE&&(e.preventDefault(),this.audioService.toggleMute()):this.gameState.getState()==="paused"&&(e.key===S.PAUSE||e.key===S.ESCAPE?(e.preventDefault(),this.resumeGame()):e.key===S.RESTART&&(e.preventDefault(),this.restart()))})}showMenu(){this.cleanup(),this.gameState.setState("menu"),this.menu.show()}showInstructions(){this.instructions.show()}async startGame(e){this.gameState.setUserName(e),this.gameState.setState("playing"),this.menu.hide(),this.parentElement.style.backgroundImage="url('/images/bcg.jpg')",this.hotel=new _(this.parentElement),this.hud=new U(this.parentElement),this.updateHUD(),this.audioService.play("background"),this.startVisitorCycle()}startVisitorCycle(){const e=()=>{this.spawnVisitors(),this.visitorCleanupTimeout=window.setTimeout(()=>{this.cleanupVisitors()},f.visitorLifetime)};e(),this.visitorSpawnInterval=window.setInterval(e,f.visitorSpawnInterval),this.darkModeTimeout=window.setTimeout(()=>{this.toggleDarkMode()},f.darkModeDuration),this.cycleInterval=window.setInterval(()=>{e(),this.darkModeTimeout=window.setTimeout(()=>{this.toggleDarkMode()},f.darkModeDuration)},f.darkModeInterval)}spawnVisitors(){const e=this.settingsConfig.spawnCount;for(let t=0;t<e;t++){const s=new $(this.gameState.hasTheRing());this.visitors.push(s),this.parentElement.appendChild(s.domElement),s.domElement.addEventListener("pointerdown",i=>{i.preventDefault(),this.handleVisitorClick(s)}),s.domElement.addEventListener("keydown",i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),this.handleVisitorClick(s))})}}cleanupVisitors(){this.visitors.forEach(e=>e.destroy()),this.visitors=[]}toggleDarkMode(){const e=!this.gameState.isDarkModeActive();this.gameState.setDarkMode(e),this.parentElement.style.backgroundImage=e?"url('/images/dark-bcg.jpg')":"url('/images/bcg.jpg')",e&&(this.darkModeTimeout=window.setTimeout(()=>{this.toggleDarkMode()},f.darkModeDuration))}handleVisitorClick(e){if(this.gameState.getState()!=="playing")return;const t=this.gameState.isDarkModeActive(),s=e.domElement.getBoundingClientRect(),i=s.left+s.width/2,o=s.top+s.height/2;t?this.handleVisitorClickEvil(e):this.handleVisitorClickGood(e);const l=e.type;l==="gandalf"||l==="sauron"||l==="ring"?this.particleEffect.createClickEffect(i,o,"special"):(l==="human"||l==="elf")&&!t||(l==="org"||l==="goblin")&&t?this.particleEffect.createClickEffect(i,o,"good"):this.particleEffect.createClickEffect(i,o,"bad"),e.startMoving(t),this.updateHUD(),this.checkGameEnd()}handleVisitorClickGood(e){const t=e.type;t==="human"||t==="elf"?(this.gameState.addScore(p.goodVisitor),this.audioService.play("good")):t==="org"||t==="goblin"?(this.gameState.addScore(p.badVisitor),this.gameState.addHealth(b.badVisitor),this.audioService.play("bad")):t==="gandalf"&&this.gameState.getGoodWins().includes("ring")?(this.audioService.play("gandalf"),this.gameState.addScore(p.specialCharacter),this.gameState.addGoodWin("gandalf"),this.endGame("gandalf")):t==="ring"&&this.gameState.getGoodWins().length===0?(this.audioService.play("ring"),this.gameState.setCurrentSide("good"),this.gameState.addGoodWin("ring"),this.gameState.setRing(!0),this.hud?.showInfo("You captured the Ring. Find Gandalf to destroy it.")):t==="gollum"&&this.gameState.getGoodWins().includes("ring")?(this.gameState.removeGoodWin("ring"),this.gameState.setRing(!1),this.audioService.play("gollum"),this.hud?.showInfo("Gollum stole your Ring!")):t==="gollum"&&this.gameState.getDarkWins().includes("ring")?(this.gameState.removeDarkWin("ring"),this.gameState.setRing(!1),this.audioService.play("gollum"),this.hud?.showInfo("Gollum stole your Ring!")):t==="sauron"?(this.audioService.play("sauron"),this.gameState.addScore(p.specialCharacterPenalty),this.gameState.addHealth(b.specialCharacter),this.hud?.showInfo("The power of Sauron is limited on this side.")):t==="gandalf"&&!this.gameState.getGoodWins().includes("ring")?(this.audioService.play("gandalf"),this.hud?.showInfo("You should find the Ring before Gandalf!")):t==="gollum"&&this.hud?.showInfo("You don't have the Ring, Gollum run away.")}handleVisitorClickEvil(e){const t=e.type;t==="org"||t==="goblin"?(this.gameState.addScore(p.goodVisitor),this.audioService.play("bad")):t==="human"||t==="elf"?(this.gameState.addScore(p.badVisitor),this.gameState.addHealth(b.badVisitor),this.audioService.play("good")):t==="sauron"&&this.gameState.getDarkWins().includes("ring")?(this.audioService.play("sauron"),this.gameState.addScore(p.specialCharacter),this.gameState.addDarkWin("sauron"),this.endGame("sauron")):t==="ring"&&this.gameState.getDarkWins().length===0?(this.audioService.play("ring"),this.gameState.setCurrentSide("evil"),this.gameState.addDarkWin("ring"),this.gameState.setRing(!0),this.hud?.showInfo("You captured the Ring. Find Sauron to rule the Middle Earth!")):t==="gollum"&&this.gameState.getDarkWins().includes("ring")?(this.gameState.removeDarkWin("ring"),this.gameState.setRing(!1),this.audioService.play("gollum"),this.hud?.showInfo("Gollum stole your Ring!")):t==="gollum"&&this.gameState.getGoodWins().includes("ring")?(this.gameState.removeGoodWin("ring"),this.gameState.setRing(!1),this.audioService.play("gollum"),this.hud?.showInfo("Gollum stole your Ring!")):t==="gandalf"?(this.audioService.play("gandalf"),this.gameState.addScore(p.specialCharacterPenalty),this.gameState.addHealth(b.specialCharacter),this.hud?.showInfo("The power of Gandalf is limited on this side.")):t==="sauron"&&!this.gameState.getDarkWins().includes("ring")?(this.audioService.play("sauron"),this.hud?.showInfo("You should find the Ring before Sauron!")):t==="gollum"&&this.hud?.showInfo("You don't have the Ring, Gollum run away.")}updateHUD(){this.hud&&(this.hud.updateScore(this.gameState.getScore()),this.hud.updateHealth(this.gameState.getHealth()),this.hud.updateRing(this.gameState.hasTheRing(),this.gameState.isDarkModeActive(),()=>{const t=this.gameState.getCurrentSide()==="good"?"The ring is captured by Minas Tirith, find Gandalf":"The ring is captured by Mordor, find Sauron";this.hud?.showInfo(t)}))}checkGameEnd(){this.gameState.getHealth()<=0&&this.endGame("defeat")}async endGame(e){this.gameState.setState("gameOver"),this.stopAllIntervals(),this.cleanupVisitors(),this.audioService.stop("background"),await this.firebaseService.saveScore({userName:this.gameState.getUserName(),score:this.gameState.getScore()}),this.storageService.saveHighScore(this.gameState.getScore()),this.gameOver.show(e,this.gameState.getUserName(),this.gameState.getScore())}pauseGame(){this.gameState.getState()==="playing"&&(this.gameState.setState("paused"),this.stopAllIntervals(),this.audioService.stop("background"),this.pauseMenu.show())}resumeGame(){this.gameState.getState()==="paused"&&(this.gameState.setState("playing"),this.audioService.play("background"),this.pauseMenu.hide(),this.startVisitorCycle(),document.fullscreenElement===null&&this.parentElement.requestFullscreen().catch(e=>{console.warn("Could not enter fullscreen:",e)}))}showSettings(){this.settings.show()}applySettings(e){this.settingsConfig={...e},e.musicEnabled?this.audioService.unmute():this.audioService.mute(),this.audioService.setEffectsEnabled(e.soundEffectsEnabled),this.audioService.setBackgroundVolume(e.musicVolume),this.audioService.setEffectsVolume(e.effectsVolume),this.hud?.showInfo(`Settings applied! Spawning ${e.spawnCount} characters per wave.`,2e3),this.resumeGame()}async showLeaderboard(){const e=await this.firebaseService.getTopScores(10);this.leaderboard.show(e)}async showLeaderboardFromMenu(){const e=await this.firebaseService.getTopScores(10);this.leaderboard.show(e,()=>this.showMenu())}restart(){this.cleanup(),this.gameState.reset(),window.location.reload()}stopAllIntervals(){this.visitorSpawnInterval&&(clearInterval(this.visitorSpawnInterval),this.visitorSpawnInterval=null),this.visitorCleanupTimeout&&(clearTimeout(this.visitorCleanupTimeout),this.visitorCleanupTimeout=null),this.darkModeInterval&&(clearInterval(this.darkModeInterval),this.darkModeInterval=null),this.darkModeTimeout&&(clearTimeout(this.darkModeTimeout),this.darkModeTimeout=null),this.cycleInterval&&(clearInterval(this.cycleInterval),this.cycleInterval=null)}cleanup(){this.stopAllIntervals(),this.cleanupVisitors(),this.hotel?.destroy(),this.hud?.destroy(),this.pauseMenu.hide(),this.particleEffect.cleanup(),this.hotel=null,this.hud=null}destroy(){this.cleanup(),this.audioService.cleanup(),this.eventManager.clear()}}document.addEventListener("DOMContentLoaded",()=>{const r=()=>{const t=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${t}px`)};r(),window.addEventListener("resize",r),window.addEventListener("orientationchange",r);const e=document.getElementById("board");if(!e){console.error("Board element not found!");return}new Z(e)});
//# sourceMappingURL=index-PM5W9vg5.js.map
